{"version":3,"file":"product-detail-8mfrOgv1.js","sources":["../../src/pages/product-detail.html?html-proxy&index=0.js","../../src/js/product-detail.js"],"sourcesContent":["\n        import { checkAuth } from '../js/auth/auth-check.js';\n        import { setupNavigation, updateNavigation } from '../js/utils/navigation.js';\n        import { initializeStorage } from '../services/local-storage.js';\n\n        async function init() {\n            const user = await checkAuth();\n            if (!user) {\n                window.location.href = '/src/pages/auth.html';\n                return;\n            }\n            \n            initializeStorage();\n            setupNavigation();\n            updateNavigation();\n        }\n\n        init();\n    ","import { checkAuth } from './auth/auth-check.js';\nimport { setupNavigation, updateNavigation } from './utils/navigation.js';\nimport { getUserProfile, purchaseProduct, fetchProducts, fetchChannels } from '../services/local-storage.js';\n\nlet currentProduct = null;\nlet userProfile = null;\nlet currentChannel = null;\n\nasync function loadUserProfile() {\n    userProfile = await getUserProfile();\n    if (userProfile) {\n        const currentPointsElement = document.getElementById('currentPoints');\n        if (currentPointsElement) {\n            currentPointsElement.textContent = userProfile.points.toLocaleString();\n        }\n    }\n}\n\nasync function loadProductDetails() {\n    const urlParams = new URLSearchParams(window.location.search);\n    const productId = urlParams.get('id');\n    \n    if (!productId) {\n        window.location.href = '/src/pages/market.html';\n        return;\n    }\n\n    const products = await fetchProducts();\n    currentProduct = products.find(p => p.id === productId);\n\n    if (!currentProduct) {\n        window.location.href = '/src/pages/market.html';\n        return;\n    }\n\n    // ÂïÜÂìÅË©≥Á¥∞„ÇíË°®Á§∫\n    document.getElementById('productImage').src = currentProduct.image_url;\n    document.getElementById('productImage').alt = currentProduct.name;\n    document.getElementById('productName').textContent = currentProduct.name;\n    document.getElementById('productLocation').textContent = `üìç ${currentProduct.location}`;\n    document.getElementById('productPrice').textContent = `¬•${currentProduct.price.toLocaleString()}`;\n    document.getElementById('productRating').innerHTML = `\n        <span class=\"stars\">‚≠êÔ∏è ${currentProduct.rating}</span>\n        <span class=\"sales\">Ë≤©Â£≤Êï∞: ${currentProduct.sales}</span>\n    `;\n    document.getElementById('productDescription').textContent = currentProduct.description;\n\n    // Ëæ≤ÂÆ∂Ôºà„ÉÅ„É£„É≥„Éç„É´ÔºâÊÉÖÂ†±„ÇíË°®Á§∫\n    const channels = await fetchChannels();\n    currentChannel = channels.find(c => c.id === currentProduct.channel_id);\n    \n    if (currentChannel) {\n        const farmerInfo = document.getElementById('farmerInfo');\n        if (farmerInfo) {\n            document.getElementById('farmerAvatar').src = currentChannel.image_url;\n            document.getElementById('farmerName').textContent = currentChannel.name;\n            document.getElementById('farmerLocation').textContent = `üìç ${currentChannel.location}`;\n            document.getElementById('farmerDescription').textContent = currentChannel.description;\n            document.getElementById('farmerEstablished').textContent = currentChannel.established;\n            document.getElementById('farmerStyle').textContent = currentChannel.farming_style;\n            document.getElementById('farmerSpecialties').textContent = currentChannel.specialties.join('„ÄÅ');\n            \n            // „ÉÅ„É£„É≥„Éç„É´„Éö„Éº„Ç∏„Å∏„ÅÆ„É™„É≥„ÇØ\n            const farmerHeader = farmerInfo.querySelector('.farmer-header');\n            farmerHeader.style.cursor = 'pointer';\n            farmerHeader.addEventListener('click', () => {\n                window.location.href = `/src/pages/market.html?channel=${currentChannel.id}`;\n            });\n\n            // „Éï„Ç©„É≠„Éº„Éú„Çø„É≥„ÅÆÁä∂ÊÖã„ÇíË®≠ÂÆö\n            const followButton = document.getElementById('followButton');\n            const isFollowing = localStorage.getItem(`follow_${currentChannel.id}`) === 'true';\n            if (isFollowing) {\n                followButton.classList.add('active');\n                followButton.textContent = '„Éï„Ç©„É≠„Éº‰∏≠';\n            }\n            followButton.addEventListener('click', handleFollow);\n        }\n    }\n\n    // „ÅÑ„ÅÑ„Å≠„Éú„Çø„É≥„ÅÆÁä∂ÊÖã„ÇíË®≠ÂÆö\n    const likeButton = document.getElementById('likeButton');\n    if (likeButton) {\n        const isLiked = localStorage.getItem(`like_${productId}`) === 'true';\n        if (isLiked) {\n            likeButton.classList.add('active');\n        }\n        likeButton.addEventListener('click', handleLike);\n    }\n}\n\n// „ÅÑ„ÅÑ„Å≠Ê©üËÉΩ„ÅÆÂá¶ÁêÜ\nfunction handleLike(e) {\n    e.preventDefault();\n    e.stopPropagation();\n    \n    if (!currentProduct) return;\n    \n    const productId = currentProduct.id;\n    const isLiked = localStorage.getItem(`like_${productId}`) === 'true';\n    \n    localStorage.setItem(`like_${productId}`, !isLiked);\n    e.target.classList.toggle('active');\n}\n\n// „Éï„Ç©„É≠„ÉºÊ©üËÉΩ„ÅÆÂá¶ÁêÜ\nfunction handleFollow(e) {\n    e.preventDefault();\n    e.stopPropagation();\n    \n    if (!currentChannel) return;\n    \n    const channelId = currentChannel.id;\n    const isFollowing = localStorage.getItem(`follow_${channelId}`) === 'true';\n    \n    localStorage.setItem(`follow_${channelId}`, !isFollowing);\n    e.target.classList.toggle('active');\n    e.target.textContent = !isFollowing ? '„Éï„Ç©„É≠„Éº‰∏≠' : '„Éï„Ç©„É≠„Éº';\n}\n\n// Êàª„Çã„Éú„Çø„É≥„ÅÆÂá¶ÁêÜ\ndocument.getElementById('backButton')?.addEventListener('click', () => {\n    window.history.back();\n});\n\n// „É¢„Éº„ÉÄ„É´ÁÆ°ÁêÜ\nwindow.closeAllModals = function() {\n    document.querySelectorAll('.modal').forEach(modal => {\n        modal.style.display = 'none';\n    });\n}\n\n// Èñâ„Åò„Çã„Éú„Çø„É≥„ÅÆË®≠ÂÆö\ndocument.querySelectorAll('.close-btn').forEach(btn => {\n    btn.addEventListener('click', closeAllModals);\n});\n\nwindow.addEventListener('click', (e) => {\n    if (e.target.classList.contains('modal')) {\n        closeAllModals();\n    }\n});\n\n// Ë≥ºÂÖ•„Éú„Çø„É≥„ÅÆ„Ç§„Éô„É≥„Éà\ndocument.getElementById('buyButton')?.addEventListener('click', () => {\n    document.getElementById('paymentModal').style.display = 'block';\n});\n\n// Ê±∫Ê∏àÊñπÊ≥ï„ÅÆÈÅ∏Êäû\ndocument.getElementById('pointsPayment')?.addEventListener('click', async () => {\n    if (!currentProduct || !userProfile) return;\n\n    if (userProfile.points >= currentProduct.price) {\n        try {\n            await purchaseProduct(currentProduct.id, 'point');\n            document.getElementById('paymentModal').style.display = 'none';\n            document.getElementById('completionModal').style.display = 'block';\n        } catch (error) {\n            alert('Ë≥ºÂÖ•„Å´Â§±Êïó„Åó„Åæ„Åó„Åü„ÄÇ„ÇÇ„ÅÜ‰∏ÄÂ∫¶„ÅäË©¶„Åó„Åè„Å†„Åï„ÅÑ„ÄÇ');\n        }\n    } else {\n        alert('„Éù„Ç§„É≥„Éà„Åå‰∏çË∂≥„Åó„Å¶„ÅÑ„Åæ„Åô„ÄÇ');\n    }\n});\n\ndocument.getElementById('creditPayment')?.addEventListener('click', () => {\n    document.getElementById('paymentModal').style.display = 'none';\n    document.getElementById('creditCardModal').style.display = 'block';\n});\n\n// „ÇØ„É¨„Ç∏„ÉÉ„Éà„Ç´„Éº„ÉâÊ±∫Ê∏à\ndocument.getElementById('creditCardForm')?.addEventListener('submit', async (e) => {\n    e.preventDefault();\n    if (!currentProduct) return;\n\n    try {\n        await purchaseProduct(currentProduct.id, 'credit');\n        document.getElementById('creditCardModal').style.display = 'none';\n        document.getElementById('completionModal').style.display = 'block';\n    } catch (error) {\n        alert('Ê±∫Ê∏à„Å´Â§±Êïó„Åó„Åæ„Åó„Åü„ÄÇ„ÇÇ„ÅÜ‰∏ÄÂ∫¶„ÅäË©¶„Åó„Åè„Å†„Åï„ÅÑ„ÄÇ');\n    }\n});\n\n// „Ç´„Éº„ÉâÁï™Âè∑„ÅÆ„Éï„Ç©„Éº„Éû„ÉÉ„Éà\ndocument.getElementById('cardNumber')?.addEventListener('input', (e) => {\n    let value = e.target.value.replace(/\\D/g, '');\n    value = value.replace(/(\\d{4})(?=\\d)/g, '$1 ');\n    e.target.value = value;\n});\n\n// ÊúâÂäπÊúüÈôê„ÅÆ„Éï„Ç©„Éº„Éû„ÉÉ„Éà\ndocument.getElementById('expiryDate')?.addEventListener('input', (e) => {\n    let value = e.target.value.replace(/\\D/g, '');\n    if (value.length >= 2) {\n        value = value.slice(0, 2) + '/' + value.slice(2);\n    }\n    e.target.value = value;\n});\n\n// CVV„ÅÆÊï∞Â≠ó„ÅÆ„ÅøÂÖ•Âäõ\ndocument.getElementById('cvv')?.addEventListener('input', (e) => {\n    e.target.value = e.target.value.replace(/\\D/g, '');\n});\n\n// ÂàùÊúüÂåñ\nasync function init() {\n    const user = await checkAuth();\n    if (!user) {\n        window.location.href = '/src/pages/auth.html';\n        return;\n    }\n\n    await Promise.all([\n        loadUserProfile(),\n        loadProductDetails()\n    ]);\n\n    setupNavigation();\n    updateNavigation();\n}\n\ndocument.addEventListener('DOMContentLoaded', init);"],"names":["init","checkAuth","initializeStorage","setupNavigation","updateNavigation","currentProduct","userProfile","currentChannel","loadUserProfile","getUserProfile","currentPointsElement","loadProductDetails","productId","fetchProducts","p","fetchChannels","c","farmerInfo","farmerHeader","followButton","handleFollow","likeButton","handleLike","isLiked","channelId","isFollowing","_a","modal","btn","purchaseProduct","value"],"mappings":"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"}