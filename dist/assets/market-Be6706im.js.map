{"version":3,"file":"market-Be6706im.js","sources":["../../src/pages/market.html?html-proxy&index=0.js","../../src/js/market.js"],"sourcesContent":["\n        import { checkAuth } from '../js/auth/auth-check.js';\n        import { setupNavigation, updateNavigation } from '../js/utils/navigation.js';\n        import { initializeStorage } from '../services/local-storage.js';\n\n        async function init() {\n            const user = await checkAuth();\n            if (!user) {\n                window.location.href = '/src/pages/auth.html';\n                return;\n            }\n            \n            initializeStorage();\n            setupNavigation();\n            updateNavigation();\n        }\n\n        init();\n    ","import { \n    fetchProducts, \n    searchProducts, \n    filterProducts,\n    fetchChannels,\n    getUserProfile,\n    getChannelProducts\n} from '../services/local-storage.js';\n\ndocument.addEventListener('DOMContentLoaded', async () => {\n    let userProfile = null;\n\n    // URL„Éë„É©„É°„Éº„Çø„Åã„Çâ„ÉÅ„É£„É≥„Éç„É´ID„ÇíÂèñÂæó\n    const urlParams = new URLSearchParams(window.location.search);\n    const selectedChannelId = urlParams.get('channel');\n\n    // „É¶„Éº„Ç∂„Éº„Éó„É≠„Éï„Ç£„Éº„É´„ÅÆË™≠„ÅøËæº„Åø\n    async function loadUserProfile() {\n        userProfile = await getUserProfile();\n        const currentPointsElement = document.getElementById('currentPoints');\n        if (userProfile && currentPointsElement) {\n            currentPointsElement.textContent = userProfile.points.toLocaleString();\n        }\n    }\n\n    // ÂïÜÂìÅ‰∏ÄË¶ß„ÅÆË°®Á§∫\n    async function renderProducts(products) {\n        const grid = document.getElementById('productGrid');\n        if (!grid) return;\n\n        grid.innerHTML = products.map(product => `\n            <div class=\"product-card ${product.sold ? 'sold' : ''}\" data-id=\"${product.id}\">\n                <div class=\"favorite-btn\" data-product-id=\"${product.id}\">‚ù§Ô∏è</div>\n                <img src=\"${product.image_url}\" alt=\"${product.name}\" class=\"product-image\">\n                <div class=\"product-info\">\n                    <p class=\"product-location\">üìç ${product.location}</p>\n                    <h3 class=\"product-name\">${product.name}</h3>\n                    <div class=\"product-rating\">\n                        <span class=\"stars\">‚≠êÔ∏è ${product.rating}</span>\n                        <span class=\"sales\">Ë≤©Â£≤Êï∞: ${product.sales}</span>\n                    </div>\n                    <p class=\"product-price\">\n                        ${product.sold ? '<span class=\"sold-label\">SOLD OUT</span>' : `¬•${product.price.toLocaleString()}`}\n                    </p>\n                </div>\n            </div>\n        `).join('');\n\n        // ÂïÜÂìÅ„Ç´„Éº„Éâ„ÅÆ„ÇØ„É™„ÉÉ„ÇØ„Ç§„Éô„É≥„Éà„ÇíË®≠ÂÆö\n        grid.querySelectorAll('.product-card').forEach(card => {\n            card.addEventListener('click', (e) => {\n                // „ÅäÊ∞ó„Å´ÂÖ•„Çä„Éú„Çø„É≥„ÅÆ„ÇØ„É™„ÉÉ„ÇØÊôÇ„ÅØË©≥Á¥∞„Éö„Éº„Ç∏„Å´ÈÅ∑Áßª„Åó„Å™„ÅÑ\n                if (e.target.classList.contains('favorite-btn')) {\n                    e.preventDefault();\n                    return;\n                }\n\n                const productId = card.dataset.id;\n                window.location.href = `/src/pages/product-detail.html?id=${productId}`;\n            });\n        });\n    }\n\n    // „ÉÅ„É£„É≥„Éç„É´‰∏ÄË¶ß„ÅÆË°®Á§∫\n    async function renderChannels() {\n        const channels = await fetchChannels();\n        const channelList = document.querySelector('.channel-list');\n        const marketHome = document.getElementById('marketHome');\n        \n        if (!channelList || !marketHome) return;\n\n        // „ÉÅ„É£„É≥„Éç„É´„ÅåÈÅ∏Êäû„Åï„Çå„Å¶„ÅÑ„ÇãÂ†¥Âêà„ÅØ„Éõ„Éº„É†„Çª„ÇØ„Ç∑„Éß„É≥„ÇíÈùûË°®Á§∫\n        if (selectedChannelId) {\n            marketHome.style.display = 'none';\n        } else {\n            marketHome.style.display = 'block';\n            channelList.innerHTML = channels.map(channel => `\n                <a href=\"/src/pages/market.html?channel=${channel.id}\" class=\"channel-item\">\n                    <div class=\"channel-avatar\">\n                        <img src=\"${channel.image_url}\" alt=\"${channel.name}\">\n                        ${channel.is_live ? '<span class=\"live-badge\">LIVE</span>' : ''}\n                    </div>\n                    <p class=\"channel-name\">${channel.name}</p>\n                    <p class=\"channel-likes\">‚ù§Ô∏è ${(channel.likes / 1000).toFixed(1)}K</p>\n                </a>\n            `).join('');\n        }\n    }\n\n    // ÂàùÊúüË°®Á§∫\n    const products = await fetchProducts();\n    let filteredProducts = products;\n\n    // „ÉÅ„É£„É≥„Éç„É´„ÅåÈÅ∏Êäû„Åï„Çå„Å¶„ÅÑ„ÇãÂ†¥Âêà„ÅØ„ÄÅ„Åù„ÅÆ„ÉÅ„É£„É≥„Éç„É´„ÅÆÂïÜÂìÅ„ÅÆ„Åø„ÇíË°®Á§∫\n    if (selectedChannelId) {\n        filteredProducts = products.filter(p => p.channel_id === selectedChannelId);\n        \n        // „ÉÅ„É£„É≥„Éç„É´ÊÉÖÂ†±„ÇíË°®Á§∫\n        const channels = await fetchChannels();\n        const selectedChannel = channels.find(c => c.id === selectedChannelId);\n        if (selectedChannel) {\n            const marketContainer = document.querySelector('.market-container');\n            const channelHeader = document.createElement('div');\n            channelHeader.className = 'channel-header-large';\n            channelHeader.innerHTML = `\n                <div class=\"channel-info-large\">\n                    <img src=\"${selectedChannel.image_url}\" alt=\"${selectedChannel.name}\" class=\"channel-avatar-large\">\n                    <div class=\"channel-details-large\">\n                        <h2>${selectedChannel.name}</h2>\n                        <p class=\"channel-location\">üìç ${selectedChannel.location}</p>\n                        <p class=\"channel-description\">${selectedChannel.description}</p>\n                        <div class=\"channel-stats\">\n                            <div class=\"stat-item\">\n                                <span class=\"stat-label\">ÂâµÊ•≠</span>\n                                <span class=\"stat-value\">${selectedChannel.established || 'Êú™Ë®≠ÂÆö'}</span>\n                            </div>\n                            <div class=\"stat-item\">\n                                <span class=\"stat-label\">Ëæ≤Ê≥ï</span>\n                                <span class=\"stat-value\">${selectedChannel.farming_style || 'Êú™Ë®≠ÂÆö'}</span>\n                            </div>\n                            <div class=\"stat-item\">\n                                <span class=\"stat-label\">Â∞ÇÈñÄÂàÜÈáé</span>\n                                <span class=\"stat-value\">${selectedChannel.specialties ? selectedChannel.specialties.join('„ÄÅ') : 'Êú™Ë®≠ÂÆö'}</span>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            `;\n            marketContainer.insertBefore(channelHeader, marketContainer.firstChild);\n        }\n    }\n\n    await Promise.all([\n        loadUserProfile(),\n        renderChannels(),\n        renderProducts(filteredProducts)\n    ]);\n\n    // „Éï„Ç£„É´„Çø„ÉºÊ©üËÉΩ\n    const filterBtns = document.querySelectorAll('.filter-btn');\n    filterBtns.forEach(btn => {\n        btn.addEventListener('click', async () => {\n            filterBtns.forEach(b => b.classList.remove('active'));\n            btn.classList.add('active');\n            \n            const sortBy = btn.dataset.sort;\n            const region = document.querySelector('.region-select').value;\n            let products = await filterProducts({ sortBy, region });\n            \n            // „ÉÅ„É£„É≥„Éç„É´„ÅåÈÅ∏Êäû„Åï„Çå„Å¶„ÅÑ„ÇãÂ†¥Âêà„ÅØ„ÄÅ„Åù„ÅÆ„ÉÅ„É£„É≥„Éç„É´„ÅÆÂïÜÂìÅ„ÅÆ„Åø„Çí„Éï„Ç£„É´„Çø„Éº\n            if (selectedChannelId) {\n                products = products.filter(p => p.channel_id === selectedChannelId);\n            }\n            \n            renderProducts(products);\n        });\n    });\n\n    // Âú∞Âüü„Éï„Ç£„É´„Çø„Éº\n    const regionSelect = document.querySelector('.region-select');\n    regionSelect?.addEventListener('change', async (e) => {\n        const region = e.target.value;\n        const sortBy = document.querySelector('.filter-btn.active').dataset.sort;\n        let products = await filterProducts({ sortBy, region });\n        \n        // „ÉÅ„É£„É≥„Éç„É´„ÅåÈÅ∏Êäû„Åï„Çå„Å¶„ÅÑ„ÇãÂ†¥Âêà„ÅØ„ÄÅ„Åù„ÅÆ„ÉÅ„É£„É≥„Éç„É´„ÅÆÂïÜÂìÅ„ÅÆ„Åø„Çí„Éï„Ç£„É´„Çø„Éº\n        if (selectedChannelId) {\n            products = products.filter(p => p.channel_id === selectedChannelId);\n        }\n        \n        renderProducts(products);\n    });\n});"],"names":["init","checkAuth","initializeStorage","setupNavigation","updateNavigation","userProfile","selectedChannelId","loadUserProfile","getUserProfile","currentPointsElement","renderProducts","products","grid","product","card","e","productId","renderChannels","channels","fetchChannels","channelList","marketHome","channel","fetchProducts","filteredProducts","p","selectedChannel","c","marketContainer","channelHeader","filterBtns","btn","b","sortBy","region","filterProducts","regionSelect"],"mappings":"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"}